<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>사용자 정산 결과 | 관리자</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/admin-settlement.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div th:replace="layout/sidebar :: sidebar"></div>

<div class="container-fluid" style="margin-left: 260px; padding-top: 30px;">
    <h1>📋 사용자 정산 결과 - 
        <span th:text="${settlementMonth.format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM'))}"></span>
    </h1>

    <div class="table-responsive mt-4">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>이름</th>
                    <th>전화번호</th>
                    <th>이메일</th>
                    <th>구독 상품</th>
                    <th>정산 금액</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${settlements.contents}">
                    <td th:text="${user.user.userId}"></td>
                    <td th:text="${user.user.name}"></td>
                    <td th:text="${user.user.phone}"></td>
                    <td th:text="${user.user.email}"></td>
                   <td>
					    <span th:if="${user.products != null}" 
					          th:each="prod : ${user.products}" 
					          th:text="${prod.productName} + ' (' + prod.subscribeCount + ')' + ' '"></span>
					    <span th:if="${user.products == null}">-</span>
					</td>


                    <td th:text="${user.totalPrice != null ? user.totalPrice : 0}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 페이징 -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{|/admin/users/settlements?settlementMonth=${settlementMonth.format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM'))}&page=${currentPage-1}|}">
                   이전
                </a>
            </li>
            <li class="page-item disabled">
                <span class="page-link">페이지 <span th:text="${currentPage+1}"></span> / <span th:text="${settlements.totalPages}"></span></span>
            </li>
            <li class="page-item" th:classappend="${currentPage+1 >= settlements.totalPages} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{|/admin/users/settlements?settlementMonth=${settlementMonth.format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM'))}&page=${currentPage+1}|}">
                   다음
                </a>
            </li>
        </ul>
    </nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
