<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>정산 배정 로그 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/whole-process-dashboard.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/log_list.css}">
</head>
<body>
<div th:replace="~{layout/sidebar :: sidebar}"></div>

<div class="container">
  <h1>정산 배치 로그 관리</h1>
  <div class="card filter-container">
    <form th:action="@{/admin/logs}" method="get" class="log-filter-form">
      <div class="filter-group main-date">
        <label>조회 기간 설정</label>
        <div class="select-wrapper">
          <select name="year" class="large-select">
            <option value="">년도(전체)</option>
            <option th:each="y : ${#numbers.sequence(2024, 2026)}"
                    th:value="${y}" th:text="${y} + '년'"
                    th:selected="${selectedYear == #strings.toString(y)}"></option>
          </select>
          <select name="month" class="large-select">
            <option value="">월(전체)</option>
            <option th:each="m : ${#numbers.sequence(1, 12)}"
                    th:value="${m < 10 ? '0'+m : m}" th:text="${m} + '월'"
                    th:selected="${selectedMonth == (m < 10 ? '0'+m : #strings.toString(m))}"></option>
          </select>
          <select name="day" class="large-select">
            <option value="">일(전체)</option>
            <option th:each="d : ${#numbers.sequence(1, 31)}"
                    th:value="${d < 10 ? '0'+d : d}" th:text="${d} + '일'"
                    th:selected="${selectedDay == (d < 10 ? '0'+d : #strings.toString(d))}"></option>
          </select>
        </div>
      </div>

      <div class="filter-group sort-group">
        <label>정렬 기준</label>
        <select name="sort" class="large-select full-width" onchange="this.form.submit()">
          <option value="latest" th:selected="${selectedSort == 'latest'}">최신순</option>
          <option value="old" th:selected="${selectedSort == 'old'}">오래된 순</option>
        </select>
      </div>

      <div class="filter-actions">
        <button type="submit" class="btn-search">검색하기</button>
        <a th:href="@{/admin/logs}" class="btn-reset">초기화</a>
      </div>
    </form>
  </div>

  <div class="card list-card">
    <table class="template-table log-table">
      <thead>
      <tr>
        <th>파일명</th>
        <th>상태</th> <th>생성 일시</th>
        <th>작업</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="file : ${logFiles}">
        <td th:text="${file.fileName}" style="font-family: monospace;"></td>
        <td>
          <span th:if="${file.hasError}" class="badge badge-fail">ERROR</span>
          <span th:unless="${file.hasError}" class="badge badge-success">NORMAL</span>
        </td>
        <td th:text="${#temporals.format(file.dateTime, 'yyyy-MM-dd HH:mm')}"></td>
        <td>
          <a th:href="@{/admin/logs/view/{name}(name=${file.fileName})}" class="btn btn-view">상세보기</a>
          <a th:href="@{/admin/logs/download/{name}(name=${file.fileName})}" class="btn btn-download">다운로드</a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>
