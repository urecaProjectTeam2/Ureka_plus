# application-local.yml
spring:
  config:
    activate:
      on-profile: local

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # ?rewriteBatchedStatements=true&allowMultiQueries=true ì˜µì…˜ ì„¤ëª…
    # (ê¸°ì¡´) 1000ê±´ ì €ì¥ ì‹œ: DBì™€ 1000ë²ˆ ëŒ€í™”
    # (ë³€ê²½) 1000ê±´ ì €ì¥ ì‹œ: DBì™€ 1ë²ˆ ëŒ€í™”
    url: jdbc:mysql://localhost:13306/billing_batch?rewriteBatchedStatements=true&allowMultiQueries=true
    username: ${DB_USER} #ë¡œì»¬ë¡œ í…ŒìŠ¤íŠ¸ ì‹œ, ì§ì ‘ ê°’ ì…ë ¥í•˜ê¸°
    password: ${DB_PASSWORD} #ë¡œì»¬ë¡œ í…ŒìŠ¤íŠ¸ ì‹œ, ì§ì ‘ ê°’ ì…ë ¥í•˜ê¸°
    hikari:
      maximum-pool-size: 50

  # ë°°ì¹˜ ë©”íƒ€ë°ì´í„° í…Œì´ë¸” ìë™ ìƒì„± ë° ìë™ ì‹¤í–‰ ë°©ì§€
  batch:
    jdbc:
      initialize-schema: always
    job:
      enabled: false

  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

      retries: 0
      batch-size: 131072         # 65536 --> 131072(64KB-->128KB) (spring.kafka.producer.batch-size)
      compression-type: lz4     # ì••ì¶• (spring.kafka.producer.compression-type)
      acks: 1                 #ìˆ˜ì •(all --> 1) ì•ˆì •ì„± < ì†ë„ <---------------ì¶”í›„ì— ë³€ê²½ ê°€ëŠ¥

      properties:
        enable.idempotence: false
        buffer.memory: 67108864   # ë²„í¼ê°€ ê½‰ ì°¼ì„ ë•Œ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ (ê¸°ë³¸ 60ì´ˆ)
        max.request.size: 5242880 # 5MBë¡œ í™•ì¥
        linger.ms: 50           # 10ms -> 50ms (ë©”ì‹œì§€ë¥¼ ë” ëª¨ì•„ì„œ í•œ ë²ˆì— ì´ ì„±ëŠ¥ í–¥ìƒ)
        request.timeout.ms: 30000  #ì¶”ê°€

    consumer:
      group-id: billing-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.touplus.billing_batch.domain.dto"

message:
  signal:
    topic: billing-batch-done  # ğŸ””ì‹ í˜¸ ë°œí–‰ í† í”½
