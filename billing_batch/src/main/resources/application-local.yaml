# application-local.yml
spring:
  config:
    activate:
      on-profile: local

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # ?rewriteBatchedStatements=true&allowMultiQueries=true 옵션 설명
    # (기존) 1000건 저장 시: DB와 1000번 대화
    # (변경) 1000건 저장 시: DB와 1번 대화
    url: jdbc:mysql://localhost:13306/billing_batch?rewriteBatchedStatements=true&allowMultiQueries=true
    username: ${DB_USER} #로컬로 테스트 시, 직접 값 입력하기
    password: ${DB_PASSWORD} #로컬로 테스트 시, 직접 값 입력하기
    hikari:
      maximum-pool-size: 50

  # 배치 메타데이터 테이블 자동 생성 및 자동 실행 방지
  batch:
    jdbc:
      initialize-schema: always
    job:
      enabled: false

  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

      retries: 0
      batch-size: 131072         # 65536 --> 131072(64KB-->128KB) (spring.kafka.producer.batch-size)
      compression-type: lz4     # 압축 (spring.kafka.producer.compression-type)
      acks: 1                 #수정(all --> 1) 안정성 < 속도 <---------------추후에 변경 가능

      properties:
        enable.idempotence: false
        buffer.memory: 67108864   # 버퍼가 꽉 찼을 때 기다리는 시간 (기본 60초)
        max.request.size: 5242880 # 5MB로 확장
        linger.ms: 50           # 10ms -> 50ms (메시지를 더 모아서 한 번에 쏴 성능 향상)
        request.timeout.ms: 30000  #추가

    consumer:
      group-id: billing-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.touplus.billing_batch.domain.dto"
